<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.project_lupin.dao.AuctionDAO">

    <select id="selectAuction" resultType="com.boot.project_lupin.dto.AuctionDTO" parameterType="int">
        SELECT
            auction_id,
            auction_lot,
            auction_author,
            auction_title,
            auction_size,
            auction_madeDate,
            auction_materials,
            auction_authorExp,
            auction_startPrice,
            auction_guessPrice,
            auctionSchedule_id
        FROM
            auction_tb
        WHERE
            auction_lot = #{auction_lot}
            AND auctionSchedule_id = #{auctionSchedule_id}
    </select>

    <select id="auctionProgressList" resultType="com.boot.project_lupin.dto.AuctionDTO">
        <![CDATA[
        SELECT
            a.auction_id,
            a.auction_lot,
            a.auction_author,
            a.auction_title,
            a.auction_size,
            a.auction_madeDate,
            a.auction_materials,
            a.auction_authorExp,
            a.auction_startPrice,
            a.auction_guessPrice,
            a.auctionSchedule_id
        FROM
            auction_tb a
        JOIN
            auctionschedule_tb s ON a.auctionSchedule_id = s.auctionSchedule_id
        WHERE
            s.auctionSchedule_start <= NOW()
            AND s.auctionSchedule_end >= NOW()
        ]]>
    </select>

    <select id="auctionScheduledList" resultType="com.boot.project_lupin.dto.AuctionDTO">
        <![CDATA[
    SELECT
        a.auction_id,
        a.auction_lot,
        a.auction_author,
        a.auction_title,
        a.auction_size,
        a.auction_madeDate,
        a.auction_materials,
        a.auction_authorExp,
        a.auction_startPrice,
        a.auction_guessPrice,
        a.auctionSchedule_id
    FROM
        auction_tb a
    JOIN
        auctionschedule_tb s ON a.auctionSchedule_id = s.auctionSchedule_id
    WHERE
        s.auctionSchedule_start > NOW()
        AND s.auctionSchedule_id = (
            SELECT MIN(auctionSchedule_id)
            FROM auctionschedule_tb
            WHERE auctionSchedule_start > NOW()
        )
    ]]>
    </select>


    <select id="auctionResultList" resultType="com.boot.project_lupin.dto.AuctionDTO">
        <![CDATA[
        SELECT
            a.auction_id,
            a.auction_lot,
            a.auction_author,
            a.auction_title,
            a.auction_size,
            a.auction_madeDate,
            a.auction_materials,
            a.auction_authorExp,
            a.auction_startPrice,
            a.auction_guessPrice,
            a.auctionSchedule_id
        FROM
            auction_tb a
        JOIN
            auctionschedule_tb s ON a.auctionSchedule_id = s.auctionSchedule_id
        WHERE
            s.auctionSchedule_end < NOW()
        ]]>
    </select>

    <select id="auctionCount" resultType="int" parameterType="int">
        SELECT
        COUNT(*)
        FROM
        auction_tb
        WHERE
        auctionSchedule_id = #{auctionSchedule_id}
    </select>

    <!--파일 업로드1 -->
    <insert id="auctionInsertFile1">
        insert into auction_attach1(uuid ,uploadPath ,fileName, image, auction_id)
        values(#{uuid},#{uploadPath},#{fileName},#{image},#{auction_id})
    </insert>

    <select id="auctionGetFileList1" resultType="com.boot.project_lupin.dto.AuctionAttach1DTO">
        select uuid ,uploadPath ,fileName, image, auction_id
        from auction_attach1 where auction_id=#{auction_id}
    </select>

    <delete id="auctionDeleteFile1">
        delete from auction_attach1 where auction_id=#{auction_id}
    </delete>

    <!--파일 업로드2 -->
    <insert id="auctionInsertFile2">
        insert into auction_attach2(uuid ,uploadPath ,fileName, image, auction_id)
        values(#{uuid},#{uploadPath},#{fileName},#{image},#{auction_id})
    </insert>

    <select id="auctionGetFileList2" resultType="com.boot.project_lupin.dto.AuctionAttach2DTO">
        select uuid ,uploadPath ,fileName, image, auction_id
        from auction_attach2 where auction_id=#{auction_id}
    </select>

    <delete id="auctionDeleteFile2">
        delete from auction_attach2 where auction_id=#{auction_id}
    </delete>

</mapper>
